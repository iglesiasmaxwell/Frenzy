import{initializeApp as e}from"https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";import{getDatabase as a,ref as t,child as l,get as n,set as o,push as i,update as d,remove as s,onValue as c,query as r,orderByChild as u,equalTo as g}from"https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";import{firebaseConfig as h}from"../min/firebaseConfig.min.js";let app=e(h),database=a(app),bookCountRef=t(database,"book"),waitList=r(t(database,"book"),u("status/waitlist"),g(!1)),reLoading=!1,once=0,newValue=[],oldValue=[],loop=0;function updateDatabase(e){if(window.navigator.onLine){let a=document.getElementById("key-"+e).innerHTML;if(null!==a){let l=t(database,"book/"+a+"/status");d(l,{waitlist:!1});let n=document.getElementById("booklistscon-"+e);n.setAttribute("hidden",!0),!0===reLoading&&reloadWindow(),console.log("accepted "+e)}}}function deleteDatabase(e){if(window.navigator.onLine){let a=document.getElementById("key-"+e).innerHTML;if(null!==a){let l=t(database,"book/"+a);s(l);let n=document.getElementById("booklistscon-"+e),o=t(database,"calendarEvents/"+a);n.setAttribute("hidden",!0),console.log("canceled "+e),s(o),!0===reLoading&&reloadWindow()}}}function reloadWindow(){window.location.reload()}function changeReloading(){let e=document.querySelector(".fa-solid.fa-rotate.fa-fade.fa-fw");!0===reLoading?(reLoading=!1,console.log("Reloading false"),e.classList.remove("spin")):!1===reLoading&&(reLoading=!0,console.log("Reloading true"),e.classList.add("spin"))}c(bookCountRef,e=>{n(waitList).then(e=>{if(e.exists()){if(announcement.textContent="",announcement.classList.remove("noannouncement"),0===once){oldValue=Object.keys(e.val()),console.log(Object.keys(e.val())),console.log(Object.values(e.val()));let a=document.getElementById("waitlists"),t=0;Object.keys(e.val()).forEach(()=>{let l=document.createElement("div");l.className="booklists-con",l.id=`booklistscon-${t}`;let n=a.appendChild(l);n.innerHTML=`<div class='info-con'><div><p class='key' id='key-${t}' hidden></p><p class='top' id='top-${t}'></p><p class='bot' id='bot-${t}'></p></div><div class='info-con-right'><p class='name' id='name-${t}'></p></div></div><div class='button-con'><a class='delete' id='delete-${t}' onclick="deleteDatabase(${t})">CANCEL</a></div>
`,n.children[0].children[0].children[0].textContent=Object.keys(e.val())[t],n.children[0].children[0].children[1].textContent=Object.values(e.val())[t].top,n.children[0].children[0].children[2].textContent=Object.values(e.val())[t].bot,n.children[0].children[1].children[0].textContent=Object.values(e.val())[t].name,t++}),once=1}else{newValue=Object.keys(e.val()),notification=document.getElementById("notification"),console.log(newValue===oldValue),console.log(newValue+" : "+newValue.length),console.log(oldValue+" : "+oldValue.length),(newValue.length<=oldValue.length||newValue===oldValue==!1)&&(console.log("data changed"),notification.classList.add("notification-on"),notification.classList.remove("fa-regular"),notification.classList.add("fa-solid"),notification.onclick=function(){reloadWindow()});let l=oldValue.length+loop;for(let n=l;n<newValue.length;n++){let o=document.createElement("div");o.className="booklists-con",o.id=`booklistscon-${l}`;let i=waitlists.appendChild(o);i.innerHTML=`<div class='info-con'><div><p class='key' id='key-${l}' hidden></p><p class='top' id='top-${l}'></p><p class='bot' id='bot-${l}'></p></div><div class='info-con-right'><p class='name' id='name-${l}'></p></div></div><div class='button-con'><a class='delete' id='delete-${l}' onclick="deleteDatabase(${l})">CANCEL</a></div>
`,i.children[0].children[0].children[0].textContent=Object.keys(e.val())[l],i.children[0].children[0].children[1].textContent=Object.values(e.val())[l].top,i.children[0].children[0].children[2].textContent=Object.values(e.val())[l].bot,i.children[0].children[1].children[0].textContent=Object.values(e.val())[l].name,l++}loop++}}else console.log("no booklist found"),announcement.textContent="No Booklist Found",announcement.classList.add("noannouncement"),notification.classList.remove("notification-on"),notification.classList.remove("fa-solid"),notification.classList.add("fa-regular"),notification.onclick=function(){}}).catch(e=>{console.error(e)})}),window.updateDatabase=updateDatabase,window.deleteDatabase=deleteDatabase,window.reloadWindow=reloadWindow,window.changeReloading=changeReloading;