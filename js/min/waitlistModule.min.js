import{initializeApp as e}from"https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";import{getDatabase as t,ref as a,child as l,get as n,set as i,push as d,update as s,remove as o,onValue as c,query as r,orderByChild as p,equalTo as u}from"https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";import{firebaseConfig as v}from"../min/firebaseConfig.min.js";let app=e(v),database=t(app),bookCountRef=a(database,"book"),waitList=r(a(database,"book"),p("status/waitlist"),u(!0)),reLoading=!1,once=0,newValue=[],oldValue=[],loop=0;function updateDatabase(e){if(window.navigator.onLine){let t=document.getElementById("key-"+e).innerHTML;if(null!==t){let l=a(database,"book/"+t+"/status"),d=a(database,"book/"+t),o=a(database,"calendarEvents/"+t);s(l,{waitlist:!1});let c=document.getElementById("waitlistscon-"+e);c.setAttribute("hidden",!0),console.log("accepted "+e),n(d).then(e=>{if(e.exists()){let t=new Date(e.val().dates.splitdate.start.date+" "+e.val().dates.splitdate.start.month+" "+e.val().dates.splitdate.start.year+" "+e.val().dates.splittime.starttime+" GMT+0800").toISOString(),a=new Date(e.val().dates.splitdate.end.date+" "+e.val().dates.splitdate.end.month+" "+e.val().dates.splitdate.end.year+" "+e.val().dates.splittime.endtime+" GMT+0800").toISOString();i(o,{title:e.val().name,start:t,end:a})}}),!0===reLoading&&reloadWindow()}}}function deleteDatabase(e){if(window.navigator.onLine){let t=document.getElementById("key-"+e).innerHTML;if(null!==t){let l=a(database,"book/"+t);o(l);let n=document.getElementById("waitlistscon-"+e);n.setAttribute("hidden",!0),!0===reLoading&&reloadWindow(),console.log("cancelled "+e)}}}function reloadWindow(){window.location.reload()}function changeReloading(){let e=document.querySelector(".fa-solid.fa-rotate.fa-fade.fa-fw");!0===reLoading?(reLoading=!1,console.log("Reloading false"),e.classList.remove("spin")):!1===reLoading&&(reLoading=!0,console.log("Reloading true"),e.classList.add("spin"))}c(bookCountRef,e=>{n(waitList).then(e=>{if(e.exists()){if(announcement.textContent="",announcement.classList.remove("noannouncement"),0===once){oldValue=Object.keys(e.val()),console.log(Object.keys(e.val())),console.log(Object.values(e.val()));let t=document.getElementById("waitlists"),a=0;Object.keys(e.val()).forEach(()=>{let l=document.createElement("div");l.className="waitlists-con",l.id=`waitlistscon-${a}`;let n=t.appendChild(l);n.innerHTML=`<div class='info-con'><div><p class='key' id='key-${a}' hidden></p><p class='top' id='top-${a}'></p><p class='bot' id='bot-${a}'></p></div><div class='info-con-right'><p class='name' id='name-${a}'></p></div></div><div class='button-con'><a class='update' id='update-${a}' onclick="updateDatabase(${a})">BOOK</a><a class='delete' id='delete-${a}' onclick="deleteDatabase(${a})">CANCEL</a></div>
`,n.children[0].children[0].children[0].textContent=Object.keys(e.val())[a],n.children[0].children[0].children[1].textContent=Object.values(e.val())[a].top,n.children[0].children[0].children[2].textContent=Object.values(e.val())[a].bot,n.children[0].children[1].children[0].textContent=Object.values(e.val())[a].name,a++}),once=1}else{newValue=Object.keys(e.val()),notification=document.getElementById("notification"),console.log(newValue===oldValue),console.log(newValue+" : "+newValue.length),console.log(oldValue+" : "+oldValue.length),(newValue.length<=oldValue.length||newValue===oldValue==!1)&&(console.log("data changed"),notification.classList.add("notification-on"),notification.classList.remove("fa-regular"),notification.classList.add("fa-solid"),notification.onclick=function(){reloadWindow()});let l=oldValue.length+loop;for(let n=l;n<newValue.length;n++){let i=document.createElement("div");i.className="waitlists-con",i.id=`waitlistscon-${l}`;let d=waitlists.appendChild(i);d.innerHTML=`<div class='info-con'><div><p class='key' id='key-${l}' hidden></p><p class='top' id='top-${l}'></p><p class='bot' id='bot-${l}'></p></div><div class='info-con-right'><p class='name' id='name-${l}'></p></div></div><div class='button-con'><a class='update' id='update-${l}' onclick="updateDatabase(${l})">BOOK</a><a class='delete' id='delete-${l}' onclick="deleteDatabase(${l})">CANCEL</a></div>
`,d.children[0].children[0].children[0].textContent=Object.keys(e.val())[l],d.children[0].children[0].children[1].textContent=Object.values(e.val())[l].top,d.children[0].children[0].children[2].textContent=Object.values(e.val())[l].bot,d.children[0].children[1].children[0].textContent=Object.values(e.val())[l].name,l++}loop++}}else console.log("no waitlist found"),announcement.textContent="No Waitlist Found",announcement.classList.add("noannouncement"),notification.classList.remove("notification-on"),notification.classList.remove("fa-solid"),notification.classList.add("fa-regular"),notification.onclick=function(){}}).catch(e=>{console.error(e)})}),window.updateDatabase=updateDatabase,window.deleteDatabase=deleteDatabase,window.reloadWindow=reloadWindow,window.changeReloading=changeReloading;