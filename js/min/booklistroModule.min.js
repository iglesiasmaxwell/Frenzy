import{initializeApp as e}from"https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";import{getDatabase as t,ref as s,child as a,get as n,set as i,push as l,update as o,remove as r,onValue as d,query as c,orderByChild as f,limitToLast as v,equalTo as h}from"https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";import{firebaseConfig as p}from"../min/firebaseConfig.min.js";let app=e(p),database=t(app),bookCountRef=s(database,"book"),waitList=c(s(database,"book")),once=0,newValue=[],oldValue=[],loop=0;function reloadWindow(){window.location.reload()}d(bookCountRef,e=>{n(waitList).then(e=>{if(e.exists()){if((announcement=document.getElementById("announcement")).textContent="",announcement.classList.remove("noannouncement"),0===once){oldValue=Object.keys(e.val()).reverse();let t=document.getElementById("waitlists"),s=new Date,a=0;Object.keys(e.val()).reverse().forEach(()=>{if(Object.values(e.val()).reverse()[a].timestamps.dmy===s.getDate()+", "+s.getMonth()+", "+s.getFullYear()){let n=document.createElement("div");n.className="booklistsro-con",n.id=`booklistsrocon-${a}`;let i=t.appendChild(n);i.innerHTML=`<div class='info-con'><div><p class='key' id='key-${a}' hidden></p><p class='top' id='top-${a}'></p><p class='bot' id='bot-${a}'></p></div><div class='info-con-right' style="display: grid; row-gap: 18px"><div style="display: flex; align-items: center; column-gap: 8px"><p class='status-text-${a}' style="margin: 0"></p><i class='fa-solid fa-fw' id='status-${a}'></i></div><p class='name' id='name-${a}' style="margin: 0"></p></div></div>
`,i.children[0].children[0].children[0].textContent=Object.keys(e.val()).reverse()[a],i.children[0].children[0].children[1].textContent=Object.values(e.val()).reverse()[a].top,i.children[0].children[0].children[2].textContent=Object.values(e.val()).reverse()[a].bot,i.children[0].children[1].children[1].textContent=Object.values(e.val()).reverse()[a].name,!0===Object.values(e.val()).reverse()[a].status.waitlist?(i.children[0].children[1].children[0].children[1].classList.add("fa-hourglass"),i.children[0].children[1].children[0].children[0].textContent="MENUNGGU"):!1===Object.values(e.val()).reverse()[a].status.waitlist&&(i.children[0].children[1].children[0].children[1].classList.add("fa-check"),i.children[0].children[1].children[0].children[0].textContent="DITERIMA")}a++}),""===t.innerHTML&&(announcement.textContent="Daftar pesan kosong",announcement.classList.add("noannouncement"),notification.classList.remove("notification-on"),notification.classList.remove("fa-solid"),notification.classList.add("fa-regular"),notification.onclick=function(){}),once=1}else newValue=Object.keys(e.val()).reverse(),notification=document.getElementById("notification"),(newValue.length<=oldValue.length||newValue===oldValue==!1)&&(notification.classList.add("notification-on"),notification.classList.remove("fa-regular"),notification.classList.add("fa-solid"),notification.onclick=function(){reloadWindow()})}else{let n=document.getElementById("booklistsrocon-0");n?(notification.classList.add("notification-on"),notification.classList.remove("fa-regular"),notification.classList.add("fa-solid"),notification.onclick=function(){reloadWindow()}):(announcement.textContent="Daftar pesan kosong",announcement.classList.add("noannouncement"),notification.classList.remove("notification-on"),notification.classList.remove("fa-solid"),notification.classList.add("fa-regular"),notification.onclick=function(){})}}).catch(e=>{console.error(e)})}),window.reloadWindow=reloadWindow;